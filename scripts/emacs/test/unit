#!/usr/bin/env doomscript

(setq curr-doomdir (getenv "DOOMDIR"))

(cd curr-doomdir)

(defcli! buttercup ()
         (require 'doom-start)
         (require 'buttercup)
         ;; prepend . to load path
         (setq load-path (cons "." load-path))
         (setq command-line-args-left
               (list
                "--no-color"
                (expand-file-name "tests.d/unit" curr-doomdir)))
         (condition-case err
             (buttercup-run-discover)
           (progn
             (print! "Failed with error: %S" err)
             (exit! 128))))

(run! "buttercup")
