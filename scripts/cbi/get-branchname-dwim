#!/usr/bin/env bash
set -euo pipefail

jiraticket=${1:-"$(s jira select-active-ticket-dwim)"}

knownName=$(sqlite3 $JIRA_HELPER_DB "SELECT name FROM ticket_branch_name WHERE ticket=\"$jiraticket\"")

if [[ -z "$knownName" ]]; then
    newname=$(s cbi make-branchname "$jiraticket")
    jo ticket=$jiraticket name=$newname | sqlite-utils insert --pk ticket "$JIRA_HELPER_DB" ticket_branch_name -
    echo "$newname"
else
    echo "$knownName"
fi
