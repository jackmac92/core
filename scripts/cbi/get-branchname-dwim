#!/usr/bin/env bash
set -euo pipefail

jiraticket=${1:-"$(s jira select-active-ticket-dwim)"}

knownName=$(sqlite3 $JIRA_HELPER_DB "SELECT branch_name FROM tickets WHERE id=\"$jiraticket\"")

if [[ -z "$knownName" ]]; then
    newname=$(s cbi make-branchname "$jiraticket")
    sqlite3 $JIRA_HELPER_DB "UPDATE tickets SET branch_name=\"$newname\" WHERE id=\"$jiraticket\""
    echo "$newname"
else
    echo "$knownName"
fi
