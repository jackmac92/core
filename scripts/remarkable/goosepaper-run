#!/usr/bin/env bash
set -euo pipefail

goosedate=$(date +%F)

cd $(mktemp -d)

fd -e json . ~/.config/goosepaper -x echo {/.} | xargs -I % docker run --rm \
    -v $HOME/.config/goosepaper:/goosepaper/mount \
    -v $PWD/outdir:/goosepaper/out \
    --uid=$UID \
    j6k4m8/goosepaper \
    goosepaper -c mount/%.json -o "out/$goosedate-daily-%.pdf"

if [[ -n ${JM_GOOSE_SIT:-""} ]]; then
    echo "Files at $PWD"
    exit 0
fi

mv ./outdir/* $HOME/Documents/remarkable/sink
