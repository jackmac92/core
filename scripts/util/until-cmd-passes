#!/usr/bin/env zx

const argsAll = process.argv
const argsScriptIdx = argsAll.findIndex(s => s.endsWith(__filename))
const cmd = argsAll.slice(argsScriptIdx + 1)

const MAX_TRIES_N = 100

let final
let i = 0
while (true) {
  if (i >= MAX_TRIES_N) {
    throw Error("Too many attempts!")
  }
  i += 1
  try {
    let p = await $`${cmd}`.quiet()
    break
  } catch (e) {
    await sleep(1000)
  }
}

try {
    for await (const chunk of p.stdout) {
      echo(chunk)
    }
} catch (e2) {
    // echo`ignored error printing the final output`
}
